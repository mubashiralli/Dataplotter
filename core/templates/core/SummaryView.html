
{% load static %}
{% block extra_css %}

<link rel="stylesheet" href="{% static 'css/app.min.css' %}" type="text/css">
<link rel="stylesheet" href="{% static 'css/bootstrap.min.css' %}" type="text/css">

<!-- DataTables -->

<link href="{% static 'libs/datatables.net-bs4/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'libs/datatables.net-select-bs4/css//select.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- Responsive datatable examples -->
<link href="{% static 'libs/datatables.net-responsive-bs4/css/responsive.bootstrap4.min.css' %}" rel="stylesheet" type="text/css" /> 

<link href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/css/selectize.css" rel="stylesheet"/>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">


<link rel="stylesheet" href="/static/css/jquery-ui.multidatespicker.css">

<!-- Responsive datatable examples -->
<style>
.spinner{
	position: absolute;
    left: calc(50% - 43px);
    top: 47px;
    z-index: 999;
}
.spinner1{
	position: fixed;
	width: 100%;
	height: 100%;
	left: 0;
	top: 0;
	background: rgba(0,0,0,.3);
	z-index: 9999999;
}
.fa-spinner{
	top: 49%;
	position: absolute;
}
#datatable2 tbody tr.selected {
	background-color: #eeeeee;
}

#datatable2 tbody tr td {
	color: black;
}
.advance_btn {
    color: #00589e;
    font-weight: bold;
	cursor: pointer;
}
.advance_btn i{
	position: absolute;
    margin-left: -16px;
	font-size:14px;
}
#apply_filters{
	width:100%;
	margin-top:8px;
	background:#00589e;
}
#apply_filters:hover{
	opacity:0.8;
}
</style>
{% endblock extra_css %}

{% block content %}
<script>
	$(document).ready(function(e){
		$('body').removeClass('vertical-collpsed');
		$('body').addClass('sidebar-enable');
		$('body').addClass('open-nav');
	});
	function exportpdf(){
		var element = document.querySelector(".waves-effect");
  		var style = window.getComputedStyle(element);
		//if(style.position == 'relative' && style.overflow == 'hidden'){
		//	document.getElementById('vertical-menu-btn').click();
		//}

		if($('body').hasClass('sidebar-enable')){
			$('body').removeClass('sidebar-enable');
			$('body').addClass('vertical-collpsed');
			$('body').addClass('open-nav');
		} else{
			$('body').removeClass('open-nav');
		}

		var viewportWidth = window.innerWidth;
		var viewportHeight = window.innerHeight;

		// Set the height and width of the body element to be equal to the viewport size
		document.body.style.width = viewportWidth + "px";
		document.body.style.height = viewportHeight + "px";
		
		$('.spinner1').removeClass('d-none');
		setTimeout(function(){
			html2canvas(document.body).then(canvas => {
				//var pdf = new jsPDF('p', 'mm', 'a4');
				var pdf = new jsPDF({
					orientation: "portrait",
					unit: "mm",
					format: "a4",
					putOnlyUsedFonts: true,
					compress: true,
					floatPrecision: 2
				});
				pdf.addImage(canvas.toDataURL('image/png'), 'PNG', 0, 0, 211, 298);
				pdf.save('Santander Car.pdf');
				$('.spinner1').addClass('d-none');
				
				if($('body').hasClass('open-nav')){
					$('body').removeClass('vertical-collpsed');
					$('body').addClass('sidebar-enable');
				}
		},500);
		});
	}

	function settitle(month_year){
		//////alert(month_year);
		var h4 = document.getElementById('latest_data');
		$('#latest_data').empty();
		h4.innerHTML += month_year;

	}

	function selected_column_comparison(labels,data,graph_id,graph_div_id,graph_name,column_names,month_names){
		let month1 = selectize.getValue();
		
		document.getElementById( graph_id ).remove();
		
		let canvas = document.createElement('canvas');
		canvas.setAttribute('id',graph_id);
		canvas.setAttribute('width','400');
		canvas.setAttribute('height','200');
		document.querySelector(graph_div_id).appendChild(canvas);
		const ctx1 = document.getElementById(graph_id).getContext('2d');
		
		//retailer_contribution_heading = document.getElementById(graph_heading)
		//retailer_contribution_heading.innerHTML += ' & ' + response.data.second_month;


		//console.log('Labels: ' + labels)
		//console.dir(data, {'maxArrayLength': null})
		//console.log('Month Names: ', month_names)
		
		backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow","gray",'']
		datasets = [];

		for(var i=0;i<1;i++){
			datasets.push({
				label: column_names[i],
				backgroundColor: backgroundColor[i],
				data: data[i]['data']
			})
		}
		
		var data = {
			labels: labels,
			datasets: datasets
		};

			//console.log('Comparison Data: ' + data['datasets'][0])
			//console.dir(data, {'maxArrayLength': null});
		

			var myBarChart = new Chart(ctx1, {
			type: 'bar',
			data: data,
			options: {
				barValueSpacing: 20,
				scales: {
				
				
				xAxes: [{
					ticks: {
					beginAtZero: true,
					stepSize: 2000,
					
					display:true,
					text:''
					
					}
				}],
				y: {
					beginAtZero: true,
					title:{
						display:true,
						text:''
					},
					
					ticks:{
						stepSize: 1000
					},
					grid: {
						display: false
					}
				},

				}
			}
			});
	}

	function setcolumn(e){
		
		$('.spinner1').removeClass('d-none');
		// FOR retailer_deposit_contribution
		//var month1 = selectize.getValue();
		var column = selectize3.getValue();

		//All Graphs On Change Method
		axios({
			method:'GET',
			url: "{% url 'generate_selected_column_graphs_dashboard' %}?month="+month1+"&selected_column="+column+"",
		}).then(function(response){
			$('.spinner1').addClass('d-none');

			////console.dir('Output: ', response)
			
			if (spliting_date_length == 1){
				selected_column_comparison(response.data.comparison_chart[0]['labels'],response.data.comparison_chart,'column','#column_graph','Price',response.data.columns,response.data.month_names)
				
				var columns_array = response.data.columns;
				$('.column_chart_heading').html(columns_array[0])
			}
			else
			{
				/*
				multiple_bars_chartjs_graph_onchange(response.data.retailer_contribution[0]['labels'],response.data.retailer_contribution,'retailer_deposit_contribution','#retailer_deposit_contribution_graph','Retailer Deposit Contribution',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.customer_deposit[0]['labels'],response.data.customer_deposit,'customer_deposit','#customer_deposit_graph','Customer Deposit',response.data.month_names,response.data.months_length)				
				multiple_bars_chartjs_graph_onchange(response.data.monthly_payment[0]['labels'],response.data.monthly_payment,'monthly_payment','#monthly_payment_graph','Monthly Payment',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.representative_apr[0]['labels'],response.data.representative_apr,'representative_apr','#representative_apr_graph','Representative APR',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.on_the_road_price[0]['labels'],response.data.on_the_road_price,'on_the_road_price','#on_the_road_price_graph','On The Road Price',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.purchase_final_payment[0]['labels'],response.data.purchase_final_payment,'purchase_final_payment','#purchase_final_payment_graph','Purchase Final Payment',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.duration_of_agreement[0]['labels'],response.data.duration_of_agreement,'duration_of_agreement','#duration_of_agreement_graph','Duration Of Agreement',response.data.month_names,response.data.months_length)
				multiple_bars_chartjs_graph_onchange(response.data.amount_of_credit[0]['labels'],response.data.amount_of_credit,'amount_of_credit','#amount_of_credit_graph','Amount Of Credit',response.data.month_names,response.data.months_length)
				*/
				
			}
			
		});
	}


	function settypeoffinance(e){

		//var month1 = selectize.getValue();
		var datepicker_value = $('#datepicker').val();
		spliting_date_length = datepicker_value.split(',').length;
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();
		////alert(finanace_offers)

		var table = $('#datatable2').DataTable();
		table.destroy();
		$('div[data-highcharts-chart="0"]').remove();
		$('div[data-highcharts-chart="1"]').remove();
		$('div[data-highcharts-chart="2"]').remove();
		$('div[data-highcharts-chart="3"]').remove();
		$('div[data-highcharts-chart="4"]').remove();
		$('div[data-highcharts-chart="5"]').remove();
		$('div[data-highcharts-chart="6"]').remove();
		$('div[data-highcharts-chart="7"]').remove();
		$('div[data-highcharts-chart="8"]').remove();
		$('div[data-highcharts-chart="9"]').remove();
		$('div[data-highcharts-chart="10"]').remove();
		$('div[data-highcharts-chart="11"]').remove();
		$('div[data-highcharts-chart="12]').remove();
		$('div[data-highcharts-chart="13"]').remove();
		$('div[data-highcharts-chart="14"]').remove();
		$('div[data-highcharts-chart="15"]').remove();

		$(document).ajaxStart(function () {
			//////alert('Start');
			
		});

		var table = $('#datatable2').DataTable({
			"initComplete": function(settings, json) {
				
			},
			
			"ajax": "{% url 'santandar-car-latest-data-onchange' %}?&date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
			"drawCallback": function (settings) { 
				// Here the response
				var response = settings.json;
				//console.log(response.latest_month_year);
				settitle(response.latest_month_year);
				

				
			},
			processing:true,
			"language": {
				processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'},
			searchPanes: {
				cascadePanes: true,
				viewTotal: true,
				layout: 'columns-4',
				"columns": [0,1,2,3]
			},
			dom: 'Plfrtip',
			
			"pagingType": "numbers",
			
			sort:true,
			columns: [
			{"data": "users.DateExtractRun","name":"DateExtractRun"},
			{"data": "users.CarMake","name":"CarMake"},
			{"data": "users.CarModel","name":"Car Model"},
			{"data": "users.TypeofFinance","name":"TypeofFinance"},
			{"data": "users.MonthlyPayment","name":"MonthlyPayment"},
			{"data": "users.CustomerDeposit","name":"CustomerDeposit"},
			{"data": "users.RetailerDepositContribution","name":"RetailerDepositContribution"},
			{"data": "users.RepresentativeAPR","name":"RepresentativeAPR"},
			{"data": "users.TotalAmountPayable","name":"TotalAmountPayable"},
			{"data": "users.OnTheRoadPrice","name":"OnTheRoadPrice"},
			{"data": "users.DurationofAgreement","name":"DurationofAgreement"},
			{"data": "users.OptionalPurchase_FinalPayment","name":"OptionalPurchase_FinalPayment"},
			{"data": "users.AmountofCredit","name":"AmountofCredit"},
			{"data": "users.OptionToPurchase_PurchaseActivationFee","name":"OptionToPurchase_PurchaseActivationFee"},
			{"data": "users.FixedInterestRate_RateofinterestPA","name":"FixedInterestRate_RateofinterestPA"},
			{"data": "users.ExcessMilageCharge","name":"ExcessMilageCharge"},
			{"data": "users.AverageMilesPerYear","name":"AverageMilesPerYear"},
			{"data": "users.RetailCashPrice","name":"RetailCashPrice"},
			{"data": "users.OfferExpiryDate","name":"OfferExpiryDate"},
			{"data": "users.DepositPercent","name":"DepositPercent"},
			{"data": "users.FinalPaymentPercent","name":"FinalPaymentPercent"},
			{"data": "users.WebpageURL","name":"WebpageURL"},
			{"data": "users.CarimageURL","name":"CarimageURL"}
			],
			
			
		serverSide: true,
		select: true,
		});
		$(document).ajaxStop(function () {
			
		});

		axios({
			method:'GET',
			url: "{% url 'total_deals' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_graph').appendChild(canvas);

			var length = response.data.data.length;
			////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			const ctx1 = document.getElementById('total_deals').getContext('2d');
			var total = '';
			if (spliting_date_length == 1){
			
				labels = response.data.data[0].labels;
				// ////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']
				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					
					for(var j=0;j<keys.length;j++){
						////alert(keys[j])
						////alert(response.data.data[i][keys[j]][0])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}
					

					/*
					datasets.push({
						label: keys[0],
						backgroundColor: "#848fdf",
						
						data: response.data.data[i].PCH[0]
						
					},{
						label: keys[1],
						backgroundColor: "thistle",
						
						data: response.data.data[i].PCP[0],
						
					},{
						label: keys[2],
						backgroundColor: "plum",
						
						data: response.data.data[i].BCH[0],
					},{
						label:keys[3],
						backgroundColor: "red",
						
						data: response.data.data[i].HP[0],
					},{
						label: keys[4],
						backgroundColor: "violet",
						
						data: response.data.data[i].CH[0]
					},{
						label: keys[5],
						backgroundColor: "blue",
						
						data: response.data.data[i].CCH[0]
					})
					*/
					

				
				
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
				type: 'bar',
				data: data,
				options: {
					plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					},
					responsive: true,
					
					scales: {
					x: {
						stacked: true,
					},
					y: {
						stacked: true,
						title:{
						display:true,
						text:'Total Deals'
						},
					}
					
					}
				}
				});
			
			}
			else{
				
				document.getElementById( "total_deals" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				
				document.querySelector('#total_deals_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals').getContext('2d');
				
				
				labels = response.data.data[0].labels;
				//////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']

				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					//alert('Data Length Iteration Number: ' + i)
					for(var j=0;j<keys.length;j++){
						//alert('Keys: '+ keys[j])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}

				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
						plugins: {
						legend: {
							display:false,
						},
						
						zoom: {
							zoom: {
							wheel: {
								enabled: true,
							},
							pinch: {
								enabled: true
							},
							mode: 'xy',
							}
						}
						
						},
						tooltips: {
							enabled: false
						},
						responsive: true,
						
						
						scales: {
							x: {
								stacked: true,
							},
							y: {
								stacked: true,
								title:{
								display:true,
								text:'Total Deals'
								},
							},
							xAxes: [{
								display: true,
								scaleLabel: {
								  display: true,
								  labelString: 'Month'
								}
							  }],
							  
							
							}
					}
				});
				
			}
		
		})

		
		axios({
			method:'GET',
			url: "{% url 'total_deals_pcp' %}?&date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pcp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pcp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pcp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
			var pcp = '';
			if (spliting_date_length == 1){
			
			
			
			pcp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title:{
							display:true,
							text:'Total Deals PCP'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pcp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pcp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pcp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pcp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_ch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_ch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_ch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_ch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
			var ch = '';
			if (spliting_date_length == 1){
			
			
			
			ch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_ch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_ch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_ch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var ch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_cch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_cch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_cch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_cch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
			var cch = '';
			if (spliting_date_length == 1){
			
			
			
			cch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_cch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_cch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_cch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var cch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'total_deals_hp' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_hp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_hp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_hp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
			var hp = '';
			if (spliting_date_length == 1){
			
			
			
			hp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals HP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_hp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_hp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_hp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var hp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals HP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_pch' %}?&date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
			var pch = '';
			if (spliting_date_length == 1){
			
			
			
			pch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals PCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
				//////alert()
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_bch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_bch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_bch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_bch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
			var bch = '';
			if (spliting_date_length == 1){
			
			
			
			bch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals BCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals BCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_bch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_bch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_bch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var bch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals BCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_apr' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "average_apr" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_apr');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_apr_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_apr').getContext('2d');
			var apr = '';
			if (spliting_date_length == 1){
			
			
			
			apr = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average APR',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Average APR'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_apr" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_apr');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_apr_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_apr').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var apr = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Average APR'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_term' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_term" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_term');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_term_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_term').getContext('2d');
			var term = '';
			if (spliting_date_length == 1){
			
			
			
			term = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average Term',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Months'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_term" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_term');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_term_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_term').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var term = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Months'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'average_milage' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_milage" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_milage');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_milage_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_milage').getContext('2d');
			var milage = '';
			if (spliting_date_length == 1){
			
			
			
			milage = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Annual Milage',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Annual Milage'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_milage" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_milage');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_milage_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_milage').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var milage = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Annual Milage'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'donut-chart' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			arr2 = response.data.data;
			new_text_labels = response.data.labels;

			var options1 = {
				series: arr2,
				  chart: {
				  type: 'donut',
				},
				responsive: [{
				  breakpoint: 480,
				  options: {
					chart: {
					  width: 200
					},
				  }
				}],
				legend : false,
				labels : new_text_labels,
				dataLabels:{
					enabled:true,
					formatter: function(value, { seriesIndex, dataPointIndex, w }) {
						//console.dir(w, {'maxArrayLength': null})
						//console.log(value);
						// get labels: w.config.labels[seriesIndex]
						// get value:  w.config.series[seriesIndex]
						// get value percentage: value
						return w.config.series[seriesIndex]
					}
				}
			};

			$('#donut-chart2').remove();
			$( "#select_type_of_finance" ).after( "<div id='donut-chart2'></div>" );
			
			var donutchart3 = new ApexCharts(document.querySelector("#donut-chart2"),options1);
			donutchart3.render();
	
			div = document.getElementById('data');

			function removeAllChildNodes(parent) {
				while (parent.firstChild) {
					parent.removeChild(parent.firstChild);
				}
			}
			removeAllChildNodes(div);

			mod = arr2.length / 3;
			
			for(var i = 0; i < arr2.length; i++){

			div.innerHTML += '<div class="row">\
								<div class="col-12">\
									<div class="text-center mt-4">\
										<p class="mb-2 text-truncate">' +new_text_labels[i]+' </p>\
										<h5>'+arr2[i]+'</h5> </div>\
								</div>\
								</div>'
			}
		})

	}

	function setcarmake(e){
		
		//var carmake_filter = $('#carmake_filter').find(":selected").text();
		//var month1 = selectize.getValue();
		var datepicker_value = $('#datepicker').val();
		spliting_date_length = datepicker_value.split(',').length;
		////alert(month1)
		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var table = $('#datatable2').DataTable();
		table.destroy();
		$('div[data-highcharts-chart="0"]').remove();
		$('div[data-highcharts-chart="1"]').remove();
		$('div[data-highcharts-chart="2"]').remove();
		$('div[data-highcharts-chart="3"]').remove();
		$('div[data-highcharts-chart="4"]').remove();
		$('div[data-highcharts-chart="5"]').remove();
		$('div[data-highcharts-chart="6"]').remove();
		$('div[data-highcharts-chart="7"]').remove();
		$('div[data-highcharts-chart="8"]').remove();
		$('div[data-highcharts-chart="9"]').remove();
		$('div[data-highcharts-chart="10"]').remove();
		$('div[data-highcharts-chart="11"]').remove();
		$('div[data-highcharts-chart="12]').remove();
		$('div[data-highcharts-chart="13"]').remove();
		$('div[data-highcharts-chart="14"]').remove();
		$('div[data-highcharts-chart="15"]').remove();

		$(document).ajaxStart(function () {
			//////alert('Start');
			
		});

		var table = $('#datatable2').DataTable({
			"initComplete": function(settings, json) {
				
			},
			"ajax": "{% url 'santandar-car-latest-data-onchange' %}?&date="+datepicker_value+"&carmake="+carmake_filter+"",
			"drawCallback": function (settings) { 
				// Here the response
				var response = settings.json;
				//console.log(response.latest_month_year);
				settitle(response.latest_month_year);
				

				
			},
			processing:true,
			"language": {
				processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'},
			searchPanes: {
				cascadePanes: true,
				viewTotal: true,
				layout: 'columns-4',
				"columns": [0,1,2,3]
			},
			dom: 'Plfrtip',
			
			"pagingType": "numbers",
			
			sort:true,
			columns: [
			{"data": "users.DateExtractRun","name":"DateExtractRun"},
			{"data": "users.CarMake","name":"CarMake"},
			{"data": "users.CarModel","name":"Car Model"},
			{"data": "users.TypeofFinance","name":"TypeofFinance"},
			{"data": "users.MonthlyPayment","name":"MonthlyPayment"},
			{"data": "users.CustomerDeposit","name":"CustomerDeposit"},
			{"data": "users.RetailerDepositContribution","name":"RetailerDepositContribution"},
			{"data": "users.RepresentativeAPR","name":"RepresentativeAPR"},
			{"data": "users.TotalAmountPayable","name":"TotalAmountPayable"},
			{"data": "users.OnTheRoadPrice","name":"OnTheRoadPrice"},
			{"data": "users.DurationofAgreement","name":"DurationofAgreement"},
			{"data": "users.OptionalPurchase_FinalPayment","name":"OptionalPurchase_FinalPayment"},
			{"data": "users.AmountofCredit","name":"AmountofCredit"},
			{"data": "users.OptionToPurchase_PurchaseActivationFee","name":"OptionToPurchase_PurchaseActivationFee"},
			{"data": "users.FixedInterestRate_RateofinterestPA","name":"FixedInterestRate_RateofinterestPA"},
			{"data": "users.ExcessMilageCharge","name":"ExcessMilageCharge"},
			{"data": "users.AverageMilesPerYear","name":"AverageMilesPerYear"},
			{"data": "users.RetailCashPrice","name":"RetailCashPrice"},
			{"data": "users.OfferExpiryDate","name":"OfferExpiryDate"},
			{"data": "users.DepositPercent","name":"DepositPercent"},
			{"data": "users.FinalPaymentPercent","name":"FinalPaymentPercent"},
			{"data": "users.WebpageURL","name":"WebpageURL"},
			{"data": "users.CarimageURL","name":"CarimageURL"}
			],
			
			
		serverSide: true,
		select: true,
		});
		$(document).ajaxStop(function () {
			
		});


		axios({
			method:'GET',
			url: "{% url 'total_deals' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_graph').appendChild(canvas);


			//alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			const ctx1 = document.getElementById('total_deals').getContext('2d');
			var total = '';
			var length = response.data.data.length;

			if (spliting_date_length == 1){
			
				labels = response.data.data[0].labels;
				// ////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']
				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					
					for(var j=0;j<keys.length;j++){
						////alert(keys[j])
						////alert(response.data.data[i][keys[j]][0])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}
					

					/*
					datasets.push({
						label: keys[0],
						backgroundColor: "#848fdf",
						
						data: response.data.data[i].PCH[0]
						
					},{
						label: keys[1],
						backgroundColor: "thistle",
						
						data: response.data.data[i].PCP[0],
						
					},{
						label: keys[2],
						backgroundColor: "plum",
						
						data: response.data.data[i].BCH[0],
					},{
						label:keys[3],
						backgroundColor: "red",
						
						data: response.data.data[i].HP[0],
					},{
						label: keys[4],
						backgroundColor: "violet",
						
						data: response.data.data[i].CH[0]
					},{
						label: keys[5],
						backgroundColor: "blue",
						
						data: response.data.data[i].CCH[0]
					})
					*/
					

				
				
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
				type: 'bar',
				data: data,
				options: {
					plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					},
					responsive: true,
					scales: {
					x: {
						stacked: true,
					},
					y: {
						stacked: true,
						title:{
						display:true,
						text:'Total Deals'
						},
					}
					
					}
				}
				});
			
			}
			else{
				
				document.getElementById( "total_deals" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				
				document.querySelector('#total_deals_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals').getContext('2d');
				
				
				labels = response.data.data[0].labels;
				//////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']

				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				//alert('Data Length: ' + response.data.data.length)
				for(var i=0;i<response.data.data.length;i++){
					
					
					for(var j=0;j<keys.length;j++){
						////alert('Keys: '+ keys[j])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}

				//console.log('DataSet: ' + datasets)

				var data = {
					labels: labels,
					datasets: datasets
				};
				
				var total = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
						plugins: {
						legend: {
							display:false,
						},
						
						zoom: {
							zoom: {
							wheel: {
								enabled: true,
							},
							pinch: {
								enabled: true
							},
							mode: 'xy',
							}
						}
						
						},
						tooltips: {
							enabled: false
						},
						responsive: true,
						
						
						scales: {
							x: {
								stacked: true,
							},
							y: {
								stacked: true,
								title:{
								display:true,
								text:'Total Deals'
								},
							},
							xAxes: [{
								display: true,
								scaleLabel: {
								  display: true,
								  labelString: 'Month'
								}
							  }],
							  
							
							}
					}
				});
				
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_pcp' %}?&date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pcp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pcp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pcp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
			var myChart = '';
			if (spliting_date_length == 1){
			
			
			
			pcp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title:{
							display:true,
							text:'Total Deals PCP'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pcp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pcp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pcp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pcp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_ch' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_ch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_ch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_ch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
			var ch = '';
			if (spliting_date_length == 1){
			
			
			
			ch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_ch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_ch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_ch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var ch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_cch' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_cch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_cch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_cch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
			var cch = '';
			if (spliting_date_length == 1){
			
			
			
			cch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_cch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_cch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_cch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var cch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'total_deals_hp' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_hp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_hp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_hp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
			var hp = '';
			if (spliting_date_length == 1){
			
			
			
			hp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals HP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_hp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_hp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_hp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var hp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals HP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_pch' %}?&date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
			var pch = '';
			if (spliting_date_length == 1){
			
			
			
			pch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals PCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
				//////alert()
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_bch' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_bch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_bch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_bch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
			var bch = '';
			if (spliting_date_length == 1){
			
			
			
			bch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals BCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals BCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_bch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_bch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_bch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var bch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals BCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_apr' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "average_apr" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_apr');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_apr_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_apr').getContext('2d');
			var apr = '';
			if (spliting_date_length == 1){
			
			
			
			apr = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average APR',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Average APR'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_apr" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_apr');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_apr_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_apr').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var apr = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Average APR'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_term' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_term" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_term');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_term_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_term').getContext('2d');
			var term = '';
			if (spliting_date_length == 1){
			
			
			
			term = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average Term',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Months'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_term" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_term');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_term_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_term').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var term = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Months'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'average_milage' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_milage" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_milage');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_milage_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_milage').getContext('2d');
			var milage = '';
			if (spliting_date_length == 1){
			
			
			
			milage = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Annual Milage',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Annual Milage'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_milage" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_milage');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_milage_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_milage').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var milage = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Annual Milage'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'donut-chart' %}?date="+datepicker_value+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			arr2 = response.data.data;
			new_text_labels = response.data.labels;

			var options1 = {
				series: arr2,
				  chart: {
				  type: 'donut',
				},
				responsive: [{
				  breakpoint: 480,
				  options: {
					chart: {
					  width: 200
					},
				  }
				}],
				legend : false,
				labels : new_text_labels,
				dataLabels:{
					enabled:true,
					formatter: function(value, { seriesIndex, dataPointIndex, w }) {
						//console.dir(w, {'maxArrayLength': null})
						//console.log(value);
						// get labels: w.config.labels[seriesIndex]
						// get value:  w.config.series[seriesIndex]
						// get percentage: value
						return w.config.series[seriesIndex]
					}
				}
			};

			$('#donut-chart2').remove();
			$( "#select_type_of_finance" ).after( "<div id='donut-chart2'></div>" );
			
			var donutchart3 = new ApexCharts(document.querySelector("#donut-chart2"),options1);
			donutchart3.render();
	
			div = document.getElementById('data');

			function removeAllChildNodes(parent) {
				while (parent.firstChild) {
					parent.removeChild(parent.firstChild);
				}
			}
			removeAllChildNodes(div);

			mod = arr2.length / 3;
			
			for(var i = 0; i < arr2.length; i++){

			div.innerHTML += '<div class="row">\
								<div class="col-12">\
									<div class="text-center mt-4">\
										<p class="mb-2 text-truncate">' +new_text_labels[i]+' </p>\
										<h5>'+arr2[i]+'</h5> </div>\
								</div>\
								</div>'
			}
		})


	}

	function ChangeDonutChartFormat(e){
		//alert(e.value);
		format_type = e.value;
		//var month1 = selectize.getValue();
		////alert(month1)

		var datepicker_value = $('#datepicker').val();

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		axios({
			method:'GET',
			url: "{% url 'donut-chart' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			arr2 = response.data.data;
			new_text_labels = response.data.labels;

			if(format_type == 'value'){

				var options1 = {
					series: arr2,
					chart: {
					type: 'donut',
					},
					responsive: [{
					breakpoint: 480,
					options: {
						chart: {
						width: 200
						},
					}
					}],
					legend : false,
					labels : new_text_labels,
					dataLabels:{
						enabled:true,
						formatter: function(value, { seriesIndex, dataPointIndex, w }) {
							//console.dir(w, {'maxArrayLength': null})
							//console.log(value);
							// get labels: w.config.labels[seriesIndex]
							// get value:  w.config.series[seriesIndex]
							// get value percentage: value
							return w.config.series[seriesIndex]
						}
					}
				};
			}
			else
			{
				var options1 = {
					series: arr2,
					chart: {
					type: 'donut',
					},
					responsive: [{
					breakpoint: 480,
					options: {
						chart: {
						width: 200
						},
					}
					}],
					legend : false,
					labels : new_text_labels,
					
				};
			}

			$('#donut-chart2').remove();
			$( "#select_type_of_finance" ).after( "<div id='donut-chart2'></div>" );
			
			var donutchart3 = new ApexCharts(document.querySelector("#donut-chart2"),options1);
			donutchart3.render();
	
			div = document.getElementById('data');

			function removeAllChildNodes(parent) {
				while (parent.firstChild) {
					parent.removeChild(parent.firstChild);
				}
			}
			removeAllChildNodes(div);

			mod = arr2.length / 3;
			
			for(var i = 0; i < arr2.length; i++){

			div.innerHTML += '<div class="row">\
								<div class="col-12">\
									<div class="text-center mt-4">\
										<p class="mb-2 text-truncate">' +new_text_labels[i]+' </p>\
										<h5>'+arr2[i]+'</h5> </div>\
								</div>\
								</div>'
			}
		})

	}

	function setmonth(){
		//alert('List: '+ list)
		////var month1 = selectize.getValue();

		var datepicker_value = $('#datepicker').val();
		//alert('DatePicker Value: '+ datepicker_value)
		//alert(typeof(datepicker_value))

		spliting_date_length = datepicker_value.split(',').length;
		//alert(spliting_date_length)

		//$( "#datepicker" ).datepicker("setDate",datepicker_value); 
		
		//////alert('Set MOnth: '+ month1)
      	//console.log('Month: ' + month1)

		//month = e.value;
		//////alert(month)
		
		
		var table = $('#datatable2').DataTable();
		table.destroy();
		$('div[data-highcharts-chart="0"]').remove();
		$('div[data-highcharts-chart="1"]').remove();
		$('div[data-highcharts-chart="2"]').remove();
		$('div[data-highcharts-chart="3"]').remove();
		$('div[data-highcharts-chart="4"]').remove();
		$('div[data-highcharts-chart="5"]').remove();
		$('div[data-highcharts-chart="6"]').remove();
		$('div[data-highcharts-chart="7"]').remove();
		$('div[data-highcharts-chart="8"]').remove();
		$('div[data-highcharts-chart="9"]').remove();
		$('div[data-highcharts-chart="10"]').remove();
		$('div[data-highcharts-chart="11"]').remove();
		$('div[data-highcharts-chart="12]').remove();
		$('div[data-highcharts-chart="13"]').remove();
		$('div[data-highcharts-chart="14"]').remove();
		$('div[data-highcharts-chart="15"]').remove();

		$(document).ajaxStart(function () {
			//////alert('Start');
			
		});

		var table = $('#datatable2').DataTable({
			"initComplete": function(settings, json) {
				
			},
			"ajax": "{% url 'santandar-car-latest-data-onchange' %}?&date="+datepicker_value+"",
			"drawCallback": function (settings) { 
				// Here the response
				var response = settings.json;
				//console.log(response.latest_month_year);
				settitle(response.latest_month_year);
				

				
			},
			processing:true,
			"language": {
				processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'},
			searchPanes: {
				cascadePanes: true,
				viewTotal: true,
				layout: 'columns-4',
				"columns": [0,1,2,3]
			},
			dom: 'Plfrtip',
			
			"pagingType": "numbers",
			
			sort:true,
			columns: [
			{"data": "users.DateExtractRun","name":"DateExtractRun"},
			{"data": "users.CarMake","name":"CarMake"},
			{"data": "users.CarModel","name":"Car Model"},
			{"data": "users.TypeofFinance","name":"TypeofFinance"},
			{"data": "users.MonthlyPayment","name":"MonthlyPayment"},
			{"data": "users.CustomerDeposit","name":"CustomerDeposit"},
			{"data": "users.RetailerDepositContribution","name":"RetailerDepositContribution"},
			{"data": "users.RepresentativeAPR","name":"RepresentativeAPR"},
			{"data": "users.TotalAmountPayable","name":"TotalAmountPayable"},
			{"data": "users.OnTheRoadPrice","name":"OnTheRoadPrice"},
			{"data": "users.DurationofAgreement","name":"DurationofAgreement"},
			{"data": "users.OptionalPurchase_FinalPayment","name":"OptionalPurchase_FinalPayment"},
			{"data": "users.AmountofCredit","name":"AmountofCredit"},
			{"data": "users.OptionToPurchase_PurchaseActivationFee","name":"OptionToPurchase_PurchaseActivationFee"},
			{"data": "users.FixedInterestRate_RateofinterestPA","name":"FixedInterestRate_RateofinterestPA"},
			{"data": "users.ExcessMilageCharge","name":"ExcessMilageCharge"},
			{"data": "users.AverageMilesPerYear","name":"AverageMilesPerYear"},
			{"data": "users.RetailCashPrice","name":"RetailCashPrice"},
			{"data": "users.OfferExpiryDate","name":"OfferExpiryDate"},
			{"data": "users.DepositPercent","name":"DepositPercent"},
			{"data": "users.FinalPaymentPercent","name":"FinalPaymentPercent"},
			{"data": "users.WebpageURL","name":"WebpageURL"},
			{"data": "users.CarimageURL","name":"CarimageURL"}
			],
			
			
		serverSide: true,
		select: true,
		});
		$(document).ajaxStop(function () {
			
		});
		
		


		axios({
			method:'GET',
			url: "{% url 'total_deals' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_graph').appendChild(canvas);

			var length = response.data.data.length;

			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			const ctx1 = document.getElementById('total_deals').getContext('2d');
			var total = '';
			if (spliting_date_length == 1){
			
				labels = response.data.data[0].labels;
				// ////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']
				var keys = Object.keys(response.data.data[0]);
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					
					

					datasets.push({
						label: keys[0],
						backgroundColor: "#848fdf",
						
						data: response.data.data[i].PCH[0]
						
					},{
						label: keys[1],
						backgroundColor: "thistle",
						
						data: response.data.data[i].PCP[0],
						
					},{
						label: keys[2],
						backgroundColor: "plum",
						
						data: response.data.data[i].BCH[0],
					},{
						label:keys[3],
						backgroundColor: "red",
						
						data: response.data.data[i].HP[0],
					},{
						label: keys[4],
						backgroundColor: "violet",
						
						data: response.data.data[i].CH[0]
					},{
						label: keys[5],
						backgroundColor: "blue",
						
						data: response.data.data[i].CCH[0]
					})
				}
				
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
				type: 'bar',
				data: data,
				options: {
					plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					},
					responsive: true,
					scales: {
					x: {
						stacked: true,
					},
					y: {
						stacked: true,
						title:{
						display:true,
						text:'Total Deals'
						},
					}
					
					}
				}
				});
			
			}
			else{
				
				document.getElementById( "total_deals" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				
				document.querySelector('#total_deals_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals').getContext('2d');
				
				
				labels = response.data.data[0].labels;
				//////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']

				var keys = Object.keys(response.data.data[0]);

				
				
				for(var i=0;i<response.data.data.length;i++){
					datasets.push({
						//label: keys[0],
						backgroundColor: "#848fdf",
						stack:response.data.month_names[i],
						data: response.data.data[i].PCH[0]
						
					},{
						label: keys[1], 
						backgroundColor: "thistle",
						stack:response.data.month_names[i],
						data: response.data.data[i].PCP[0]
						
					},{
						label: keys[2],
						backgroundColor: "plum",
						stack:response.data.month_names[i],
						data: response.data.data[i].BCH[0]
					},{
						label:keys[3],
						backgroundColor: "red",
						stack:response.data.month_names[i],
						data: response.data.data[i].HP[0]
					},{
						label: keys[4],
						backgroundColor: "violet",
						stack:response.data.month_names[i],
						data: response.data.data[i].CH[0]
					},{
						label: keys[5],
						backgroundColor: "blue",
						stack:response.data.month_names[i],
						data: response.data.data[i].CCH[0]
					})
				}
				
				
				
				
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
						plugins: {
						legend: {
							display:false,
						},
						
						zoom: {
							zoom: {
							wheel: {
								enabled: true,
							},
							pinch: {
								enabled: true
							},
							mode: 'xy',
							}
						}
						},
						
						tooltips: {
							enabled: false
						},
						responsive: true,
						
						
						scales: {
							x: {
								stacked: true,
							},
							y: {
								stacked: true,
								title:{
								display:true,
								text:'Total Deals'
								},
							},
							xAxes: [{
								display: true,
								scaleLabel: {
								  display: true,
								  labelString: 'Month'
								}
							  }],
							  
							
							}
					}
				});
				
			}
		
		})
		

		//// FOR PCP

		axios({
			method:'GET',
			url: "{% url 'total_deals_pcp' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_pcp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pcp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pcp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			
			const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
			var pcp = '';
			if (spliting_date_length == 1){
			
			
			
			pcp = new Chart(ctx1, {
			type: 'bar',
			
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title:{
							display:true,
							text:'Total Deals PCP'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					zoom: {
						zoom: {
						  wheel: {
							enabled: true,
						  },
						  pinch: {
							enabled: true
						  },
						  mode: 'xy',
						}
					}
					
				}
			}
			});
			
			
			}
			else{
				
				document.getElementById( "total_deals_pcp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pcp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pcp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pcp = new Chart(ctx1, {
					
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
				  
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_ch' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_ch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_ch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_ch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
			var ch = '';
			if (spliting_date_length == 1){
			
			
			
			ch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					  
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_ch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_ch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_ch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var ch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_cch' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_cch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_cch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_cch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
			var cch = '';
			if (spliting_date_length == 1){
			
			
			
			cch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					 
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_cch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_cch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_cch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var cch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_hp' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_hp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_hp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_hp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
			var hp = '';
			if (spliting_date_length == 1){
			
			
			
			hp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals HP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_hp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_hp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_hp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var hp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals HP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_pch' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_pch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
			var pch = '';
			if (spliting_date_length == 1){
			
			
			
			pch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals PCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					 
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
				//////alert()
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'total_deals_bch' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "total_deals_bch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_bch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_bch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
			var bch = '';
			if (spliting_date_length == 1){
			
			
			
			bch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals BCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals BCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_bch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_bch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_bch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var bch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals BCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_apr' %}?date="+datepicker_value+"",
		}).then(function(response){
			document.getElementById( "average_apr" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_apr');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_apr_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_apr').getContext('2d');
			var apr = '';
			if (spliting_date_length == 1){
			
			
			
			apr = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average APR',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Average APR'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_apr" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_apr');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_apr_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_apr').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var apr = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Average APR'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})

		axios({
			method:'GET',
			url: "{% url 'average_term' %}?date="+datepicker_value+"",
		}).then(function(response){
			
			document.getElementById( "average_term" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_term');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_term_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_term').getContext('2d');
			var term = '';
			if (spliting_date_length == 1){
			
			
			
			term = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average Term',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Months'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_term" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_term');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_term_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_term').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var term = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Months'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		axios({
			method:'GET',
			url: "{% url 'average_milage' %}?date="+datepicker_value+"",
		}).then(function(response){
			
			document.getElementById( "average_milage" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_milage');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_milage_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_milage').getContext('2d');
			var milage = '';
			if (spliting_date_length == 1){
			
			
			
			milage = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Annual Milage',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Annual Milage'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_milage" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_milage');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_milage_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_milage').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var milage = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Annual Milage'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})


		


		
		axios({
			method:'GET',
			url: "{% url 'donut-chart' %}?date="+datepicker_value+"",
		}).then(function(response){
			
			arr2 = response.data.data;
			new_text_labels = response.data.labels;

			var options1 = {
				series: arr2,
				  chart: {
				  type: 'donut',
				},
				responsive: [{
				  breakpoint: 480,
				  options: {
					chart: {
					  width: 200
					},
				  }
				}],
				legend : false,
				labels : new_text_labels,
				dataLabels:{
					enabled:true,
					formatter: function(value, { seriesIndex, dataPointIndex, w }) {
						//console.dir(w, {'maxArrayLength': null})
						//console.log(value);
						// get labels: w.config.labels[seriesIndex]
						// get value:  w.config.series[seriesIndex]
						// get value percentage: value
						return w.config.series[seriesIndex]
					}
				}
			};

			$('#donut-chart2').remove();
			$( "#select_type_of_finance" ).after( "<div id='donut-chart2'></div>" );
			
			var donutchart3 = new ApexCharts(document.querySelector("#donut-chart2"),options1);
			donutchart3.render();
	
			div = document.getElementById('data');

			function removeAllChildNodes(parent) {
				while (parent.firstChild) {
					parent.removeChild(parent.firstChild);
				}
			}
			removeAllChildNodes(div);

			mod = arr2.length / 3;
			
			for(var i = 0; i < arr2.length; i++){

			div.innerHTML += '<div class="row">\
								<div class="col-12">\
									<div class="text-center mt-4">\
										<p class="mb-2 text-truncate">' +new_text_labels[i]+' </p>\
										<h5>'+arr2[i]+'</h5> </div>\
								</div>\
								</div>'
			}
		})
	}


	function ChangePCPLegend(e){
		//alert(e.value);
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;
		//alert(legend_position);
		//alert(typeof(legend_position));
		axios({
			method:'GET',
			url: "{% url 'total_deals_pcp' %}?&date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pcp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pcp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pcp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
			var pcp = '';
			if (spliting_date_length == 1){
			
			
			
			pcp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						beginAtZero: true,
						title:{
							display:true,
							text:'Total Deals PCP'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
						
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pcp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pcp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pcp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pcp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pcp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
		

		//myChart.options.plugins.legend.position = 'bottom';
		//myChart.update();

	}

	function ChangeTotalDealsLegend(e){
		//var month1 = selectize.getValue();
		var datepicker_value = $('#datepicker').val();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;
		axios({
			method:'GET',
			url: "{% url 'total_deals' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_graph').appendChild(canvas);

			var length = response.data.data.length;

			////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			const ctx1 = document.getElementById('total_deals').getContext('2d');
			var total = '';
			if (spliting_date_length == 1){
			
				labels = response.data.data[0].labels;
				// ////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']
				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					
					for(var j=0;j<keys.length;j++){
						////alert(keys[j])
						////alert(response.data.data[i][keys[j]][0])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}
					

					/*
					datasets.push({
						label: keys[0],
						backgroundColor: "#848fdf",
						
						data: response.data.data[i].PCH[0]
						
					},{
						label: keys[1],
						backgroundColor: "thistle",
						
						data: response.data.data[i].PCP[0],
						
					},{
						label: keys[2],
						backgroundColor: "plum",
						
						data: response.data.data[i].BCH[0],
					},{
						label:keys[3],
						backgroundColor: "red",
						
						data: response.data.data[i].HP[0],
					},{
						label: keys[4],
						backgroundColor: "violet",
						
						data: response.data.data[i].CH[0]
					},{
						label: keys[5],
						backgroundColor: "blue",
						
						data: response.data.data[i].CCH[0]
					})
					*/
					

				
				
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
				type: 'bar',
				data: data,
				options: {
					plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					},
					responsive: true,
					
					scales: {
					x: {
						stacked: true,
					},
					y: {
						stacked: true,
						title:{
						display:true,
						text:'Total Deals'
						},
					}
					
					}
				}
				});
			
			}
			else{
				
				document.getElementById( "total_deals" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				
				document.querySelector('#total_deals_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals').getContext('2d');
				
				
				labels = response.data.data[0].labels;
				//////alert(labels)
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];
				stack = ['1','2','3','4','5','6','7','8','9','10','11','12']

				var keys = Object.keys(response.data.data[0]);
				
				last_element = keys.pop();
				////alert(keys)
				//var new_keys = JSON.stringify(keys).replace(',"labels"','').split(',')
				
				for(var i=0;i<response.data.data.length;i++){
					//alert('Data Length Iteration Number: ' + i)
					for(var j=0;j<keys.length;j++){
						//alert('Keys: '+ keys[j])
						datasets.push({
							label: keys[j],
							backgroundColor: backgroundColor[j],
							stack:stack[i],
							data: response.data.data[i][keys[j]][0],
						})
					}
				}

				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				var total = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
						plugins: {
						legend: {
							display:false,
							position:legend_position
						},
						
						zoom: {
							zoom: {
							wheel: {
								enabled: true,
							},
							pinch: {
								enabled: true
							},
							mode: 'xy',
							}
						}
						
						},
						tooltips: {
							enabled: false
						},
						responsive: true,
						
						
						scales: {
							x: {
								stacked: true,
							},
							y: {
								stacked: true,
								title:{
								display:true,
								text:'Total Deals'
								},
							},
							xAxes: [{
								display: true,
								scaleLabel: {
								  display: true,
								  labelString: 'Month'
								}
							  }],
							  
							
							}
					}
				});
				
			}
		
		})
	}

	function ChangeCHLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;
		axios({
			method:'GET',
			url: "{% url 'total_deals_ch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_ch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_ch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_ch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
			var ch = '';
			if (spliting_date_length == 1){
			
			
			
			ch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_ch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_ch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_ch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_ch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var ch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangeCCHLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'total_deals_cch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_cch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_cch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_cch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
			var cch = '';
			if (spliting_date_length == 1){
			
			
			
			cch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals CCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals CCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_cch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_cch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_cch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_cch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var cch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals CCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangeHPLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;


		axios({
			method:'GET',
			url: "{% url 'total_deals_hp' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_hp" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_hp');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_hp_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
			var hp = '';
			if (spliting_date_length == 1){
			
			
			
			hp = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals HP',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_hp" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_hp');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_hp_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_hp').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var hp = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals HP'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangePCHLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'total_deals_pch' %}?&date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_pch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_pch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_pch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
			var pch = '';
			if (spliting_date_length == 1){
			
			
			
			pch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals PCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals PCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_pch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_pch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_pch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_pch').getContext('2d');
				//////alert()
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var pch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals PCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangeBCHLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'total_deals_bch' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "total_deals_bch" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','total_deals_bch');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#total_deals_bch_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
			var bch = '';
			if (spliting_date_length == 1){
			
			
			
			bch = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Total Deals BCH',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Total Deals BCH'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "total_deals_bch" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','total_deals_bch');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#total_deals_bch_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('total_deals_bch').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var bch = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Total Deals BCH'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangeAverageLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'average_apr' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			document.getElementById( "average_apr" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_apr');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_apr_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_apr').getContext('2d');
			var apr = '';
			if (spliting_date_length == 1){
			
			
			
			apr = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average APR',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Average APR'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_apr" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_apr');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_apr_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_apr').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var apr = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Average APR'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}	

	function ChangeTermLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'average_term' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_term" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_term');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_term_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_term').getContext('2d');
			var term = '';
			if (spliting_date_length == 1){
			
			
			
			term = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Average Term',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Months'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_term" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_term');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_term_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_term').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var term = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position:legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Months'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}

	function ChangeMilageLegend(e){
		//var month1 = selectize.getValue();
		////alert(month1)

		var carmake_filter = selectize1.getValue();
		////alert(carmake_filter)

		var finanace_offers = selectize2.getValue();

		var legend_position = e.value;

		axios({
			method:'GET',
			url: "{% url 'average_milage' %}?date="+datepicker_value+"&typeoffinance="+finanace_offers+"&carmake="+carmake_filter+"",
		}).then(function(response){
			
			document.getElementById( "average_milage" ).remove();
			let canvas = document.createElement('canvas');
			canvas.setAttribute('id','average_milage');
			canvas.setAttribute('width','400');
			canvas.setAttribute('height','200');
			document.querySelector('#average_milage_graph').appendChild(canvas);


			//////alert(month1)
			////console.log('Length of Response Data: '+ response.data.data.length);
			data = response.data.data;
			var length = response.data.data.length;
			const ctx1 = document.getElementById('average_milage').getContext('2d');
			var milage = '';
			if (spliting_date_length == 1){
			
			
			
			milage = new Chart(ctx1, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Annual Milage',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Annual Milage'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						position:legend_position
					},
					
					zoom: {
						zoom: {
						wheel: {
							enabled: true,
						},
						pinch: {
							enabled: true
						},
						mode: 'xy',
						}
					}
					
				}
			}
			});
			
			}
			else{
				
				document.getElementById( "average_milage" ).remove();
				
				let canvas = document.createElement('canvas');
				canvas.setAttribute('id','average_milage');
				canvas.setAttribute('width','400');
				canvas.setAttribute('height','200');
				document.querySelector('#average_milage_graph').appendChild(canvas);
				
				const ctx1 = document.getElementById('average_milage').getContext('2d');
				
				/*
				retailer_contribution_heading = document.getElementById('total_deals_heading')
				
				for(var i=1;i<response.data.month_names.length;i++){
					
					retailer_contribution_heading.innerHTML += ',' + response.data.month_names[i];
					
				}
				*/
				
				labels = response.data.data[0]['labels'];
				
				backgroundColor = ["#848fdf","thistle","plum","red","green","blue","black","orange","violet","yellow"]
				datasets = [];

				

				for(var i=0;i<response.data.months_length;i++){
					datasets.push({
						label: response.data.month_names[i],
						backgroundColor: backgroundColor[i],
						data: response.data.data[i]['data']
					})
				}
				//console.log(response.data)
				var data = {
					labels: labels,
					datasets: datasets
				};
				
				

				  var milage = new Chart(ctx1, {
					type: 'bar',
					data: data,
					options: {
					  barValueSpacing: 20,
					  plugins: {
						legend:{
							position: legend_position
						},
						zoom: {
						  zoom: {
							wheel: {
							  enabled: true,
							},
							pinch: {
							  enabled: true
							},
							mode: 'xy',
						  }
						}
					  },
					  scales: {
						
						y: {
							beginAtZero: true,
							title:{
								display:true,
								text:'Annual Milage'
							},
							grid: {
								display: false
							}
						},
					  }
					}
				  });
			}
		
		})
	}


</script>

<script>
	function linechart(month,linecolumnchart1,line){
		selected_month = document.querySelector('#'+month+'').value;
		////alert(selected_month);
		////alert(linecolumnchart1);

		var options1 = {
			colors: ["#6f7bd9", "#3ec59d"],
			series: [{
			name: 'Car Models',
			type: 'column',
			data: []
		  }],
			chart: {
			height: 350,
			
		  },
		  stroke: {
			width: [0, 4]
		  },
		  
		  dataLabels: {
			enabled: true,
			enabledOnSeries: [1]
		  },
		  xaxis: {
			type: 'text',
			labels: {
				style : {
					fontSize : '10px',
					fontWeight: 200,
				},
				rotate: -30
			}
		  },
		  yaxis: [{
			title: {
			  text: 'Price',
			},
		  
		  }]
		};
		  
		var chart1 = new ApexCharts(document.querySelector(linecolumnchart1), options1);
        chart1.render();
	
		axios({
			method:'GET',
			url: "{% url 'retailer_deposit_contribution' %}?month="+selected_month+"",
		}).then(function(response){
			//console.log(response.data)
			chart1.updateSeries([{
				name: 'Retailer Deposit Contribution',
				type: 'line',
				data: response.data
			},{
				name:'Car Models',
				data:response.data
			}
			])
		})


		
		
	}
</script>

<input type="text" id="dates" value="{{dates}}" hidden>

<div class="row">
	<div class="col-md-3"></div>
	<div class="col-md-3"></div>
	<div class="col-md-3"></div>
	<div class="col-md-3">
		<input type="text" name="" id="username" value="{{username}}" hidden>
		<button class="btn btn-primary export_pdf pull-right" style="float: right;" onclick="exportpdf()"> Export PDF </button>
	</div>
</div>

<div class="row">
	<div class="col-xl-8">
	
		<input type="text" id="project_id" value="{{project_id}}" hidden>
	</div>
	<div class="col-xl-4">
		<select id="select_dashboard" class="form-select" onchange="location = this.value;">
								
			<option>Select Dashboard</option>
			<!-- {% for item in projects %}
				
				{% if item.project_name == 'Santandar Car' %}
					<option value="{% url 'santander_car_dashboard' %}">Santander Car</option>
				{% elif item.project_name == 'Norton' %}
				<option value="#">Norton</option>
				{% elif item.project_name == 'Allergan' %}
				<option value="#">Allergan</option>
				{% endif %}

			{% endfor %} -->

			{% for item in user_projects %}
				{% for project in item.projects %}
					{% if project == 'Santandar Car' %}
						<option id="1" value="{% url 'santander_car_dashboard' %}">Santander Car</option>
						<option id="7" value="{% url 'santander_bike_standard_dashboard' %}">Santander Bike Standard</option>
						<option id="8" value="{% url 'santander_bike_calculated_dashboard' %}">Santander Bike Calculated</option>
						<option id="8" value="{% url 'santander_car_calculated_dashboard' %}">Santander Car Calculated</option>
						<option id="9" value="{% url 'santander_mazda_calculated_dashboard' %}">Santander Mazda Calculated</option>
						

					{% elif project == 'Norton' %}
						<option id="2" value="{% url 'norton_dashboard' %}">Norton</option>
					{% elif project == 'Allergan' %}
						<option id="3" value="{% url 'allergan_dashboard' %}">Allergan</option>
					{% elif project == 'Nuffield Health' %}
						<option id="4" value="{% url 'nuffield_dashboard' %}">Nuffield Health</option>
					{% elif project == 'Specsavers' %}
						<option id="5" value="{% url 'specsavers_dashboard' %}">Specsavers</option>
					{% endif %} 
				{% endfor %}
			{% endfor %}
			
		</select>
	</div>
</div>
<br/>

<div class="row">
	<div class="col-xl-8">
		<div class="row">
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<div class="d-flex">
							<div class="flex-1 overflow-hidden">
								<div class="spinner d-none">
									<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
								</div>
								<div class="spinner1 text-center d-none">
									<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
								</div>
								<p id="latest_number_of_records" class="text-truncate font-size-14 mb-2">No. of Records</p>
								<div class="col-md-12">
									<div class="row">
										<div class="col-md-6">
											<div class="row">
												<h4 class="mb-0" id="latest_records"></h4>
											</div>
										</div>
										<div class="col-md-6">
											<div class="row">
												
												
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="text-primary ms-auto ">
								
							</div>
						</div>
					</div>
					
				</div>
			</div>
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<div class="d-flex">
							<div class="flex-1 overflow-hidden">
								<div class="spinner d-none">
									<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
								</div>
								<p id="second_latest_number_of_records" class="text-truncate font-size-14 mb-2">No. of Records</p>
								<div class="col-md-12">
									<div class="row">
										<div class="col-md-6">
											<div class="row">
												<h4 class="mb-0" id="second_latest_records"></h4>
											</div>
										</div>
										<div class="col-md-6">
											<div class="row">
												
												
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>
					</div>
					
				</div>
			</div>
			<div class="col-md-4">
				<div class="card">
					<div class="card-body">
						<div class="d-flex">
							<div class="flex-1 overflow-hidden">
								<div class="spinner d-none">
									<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
								</div>
								<p id="third_latest_number_of_records" class="text-truncate font-size-14 mb-2">No. of Records</p>
								<div class="col-md-12">
									<div class="row">
										<div class="col-md-6">
											<div class="row">
												<h4 class="mb-0" id="third_latest_records"></h4>
											</div>
										</div>
										<div class="col-md-6">
											<div class="row">
												
												
											</div>
										</div>
									</div>
								</div>
							</div>
							
						</div>
					</div>
					
				</div>
			</div>
		</div>
		<!-- end row -->
			<div class="card">
				<div class="card-body">
					<div class="float-end d-none d-md-inline-block">
						<div class="btn-group mb-2">
							<!-- <input type="month" id="customer_deposit_month" name="customer_deposit_month" value="2022-08" onchange="customer_deposit_setmonth(this);"/> -->
							
						</div>
						
					</div>
					<label class="form-label" hidden>Select Month</label>
					<select id="month" name="month_select" multiple class="select" >
						<option value="0" selected>{{latest_month}}</option>
						<option value="1">January</option>
						<option value="2">February</option>
						<option value="3">March</option>
						<option value="4">April</option>
						<option value="5">May</option>
						<option value="6">June</option>
						<option value="7">July</option>
						<option value="8">August</option>
						<option value="9">September</option>
						<option value="10">October</option>
						<option value="11">November</option>
						<option value="12">December</option>
					</select>
					<label class="form-label">Select Date</label>
						<input type = "text"
							id = "datepicker" style="width: 100%;" onchange="setmonth();">
					<br>
					<div class="pull-right advance_btn">
						<i class="ri-add-line"></i>
						Advance
					</div>

				</div>
			</div>

			<div class="card apply_filter_card" style="display:none;">
				<div class="card-body">
					<div class="d-md-inline-block">
						<div class="row" id="filters">
							<label class="form-label">Select Carmake</label>
							<select id="carmake_filter" name="carmake_filter" multiple class="select" onchange="setcarmake(this);" >
								<option value="">Select CarMake</option>
								{%for car in carmake%}
									<option value="{{car}}">{{car}}</option>
								{% endfor %}
							</select>
							
						
							<label class="form-label">Select Type of Finance</label>
							<select id="finance_offers_filter" name="month_select" class="select" onchange="settypeoffinance(this);">
								<option value="">Select Type of Finance</option>
								{%for type in typeoffinance%}
									<option value="{{type}}">{{type}}</option>
								{% endfor %}
							</select>
							<!-- <div class="col-xs-12">
								<button class="btn btn-secondary float-right" id="apply_filters">Apply Filters</button>
							</div> -->
						</div>						
					</div>
				</div>
			</div>

			
		<div id="card-analytics-drag-area">
			
			{% if graphs_order %}
				{% for pos in graphs_order%}
					{% if pos == 1 %}
					
						<div class="card card-container-category-column" id="1">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										
									</div>
								</div>
								<select name="" id="total_deals_legend" class="pull-right" onchange="ChangeTotalDealsLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor </h4>
								<div id="total_deals_graph">
									
									<canvas id="total_deals" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 2 %}
						<div class="card card-container-category-column" id="2">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										
									</div>
								</div>
								<select name="" id="total_deals_pcp_legend" class="pull-right" onchange="ChangePCPLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For PCP </h4>
								
								<div id="total_deals_pcp_graph">
									
									<canvas id="total_deals_pcp" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 3 %}
						<div class="card card-container-category-column" id="3">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										<!-- <input type="month" id="monthly_payment_month" name="monthly_payment_month" value="2022-08" onchange="monthly_payment_setmonth(this);"/> -->
										
										 
									</div>
								</div>
								<select name="" id="total_deals_ch_legend" class="pull-right" onchange="ChangeCHLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For CH </h4>
								<div id="total_deals_ch_graph">
									
									<canvas id="total_deals_ch" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 4 %}
						<div class="card card-container-category-column" id="4">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										<!-- <input type="month" id="representative_apr_month" name="representative_apr_month" value="2022-08" onchange="representative_apr_setmonth(this);"/> -->
										
										
									</div>
								</div>
								<select name="" id="total_deals_cch_legend" class="pull-right" onchange="ChangeCCHLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For CCH </h4>
								<div id="total_deals_cch_graph">
									
									<canvas id="total_deals_cch" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 5 %}
						<div class="card card-container-category-column" id="5">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
										
										 
									</div>
								</div>
								<select name="" id="total_deals_hp_legend" class="pull-right" onchange="ChangeHPLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For HP </h4>
								<div id="total_deals_hp_graph">
									
									<canvas id="total_deals_hp" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 6 %}
						<div class="card card-container-category-column" id="6">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 
									</div>
								</div>
								<select name="" id="total_deals_pch_legend" class="pull-right" onchange="ChangePCHLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For PCH </h4>
								<div id="total_deals_pch_graph">
									
									<canvas id="total_deals_pch" width="600" height="400" ></canvas>
								</div>
							</div>
						</div>
					{% elif pos == 7 %}
						<div class="card card-container-category-column" id="7">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
										
										 
									</div>
								</div>
								<select name="" id="total_deals_bch_legend" class="pull-right" onchange="ChangeBCHLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For BCH </h4>
								<div id="total_deals_bch_graph">
									
									<canvas id="total_deals_bch" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 8 %}
						<div class="card card-container-category-column" id="8">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
										
										 
									</div>
								</div>
								<select name="" id="average_legend" class="pull-right" onchange="ChangeAverageLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Average Representative APR By Competitor </h4>
								<div id="average_apr_graph">
									
									<canvas id="average_apr" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 9 %}
						<div class="card card-container-category-column" id="9">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
										
										 
									</div>
								</div>
								<select name="" id="term_legend" class="pull-right" onchange="ChangeTermLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Average Term By Competitor </h4>
								<div id="average_term_graph">
									
									<canvas id="average_term" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					{% elif pos == 10 %}
						<div class="card card-container-category-column" id="10">
							<div class="card-body">
								<div class="float-end d-none d-md-inline-block">
									<div class="btn-group mb-2">
										 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
										
										
									</div>
								</div>
								<select name="" id="milage_legend" class="pull-right" onchange="ChangeMilageLegend(this)">
									<option value="">Select Legend Position</option>
									<option value="bottom">Bottom</option>
									<option value="right">Right</option>
									<option value="top">Top</option>
									<option value="not_display">Hide</option>

								</select>
								<h4 class="card-title mb-4" id="total_deals_heading"> Annual Milage By Competitor </h4>
								<div id="average_milage_graph">
									
									<canvas id="average_milage" width="600" height="400" ></canvas>
								</div>
							</div>
							
						</div>
					
					
					{% endif %}
					
				{% endfor %}
				<!-- <div class="card card-container-category-column" id="11">
					<div class="card">
						<div class="card-body">
							<div class="float-end d-none d-md-inline-block">
								<div class="btn-group mb-2">
									
									
								</div>
							</div>
							<h4 class="card-title mb-4 column_chart_heading"></h4>
							<div id="column_graph">
					
								<canvas id="column" width="400" height="200" ></canvas>
							</div>
							<button onclick="download('comparison');">Download</button>
						</div>
						
					</div>
				</div> -->


			{% else %}
			
				<div class="card card-container-category-column" id="1">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor </h4>
						<div id="total_deals_graph">
							
							<canvas id="total_deals" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="2">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="customer_deposit_month" name="customer_deposit_month" value="2022-08" onchange="customer_deposit_setmonth(this);"/>  -->
								
							</div>
						</div>
					
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For PCP </h4>
						<div id="total_deals_pcp_graph">
							
							<canvas id="total_deals_pcp" width="600" height="400" ></canvas>
						</div>
					</div>
				</div>
					
				
			
				<div class="card card-container-category-column" id="3">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								<!-- <input type="month" id="monthly_payment_month" name="monthly_payment_month" value="2022-08" onchange="monthly_payment_setmonth(this);"/> -->
								
								 
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For CH </h4>
						<div id="total_deals_ch_graph">
							
							<canvas id="total_deals_ch" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="4">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								<!-- <input type="month" id="representative_apr_month" name="representative_apr_month" value="2022-08" onchange="representative_apr_setmonth(this);"/> -->
								
								
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For CCH </h4>
						<div id="total_deals_cch_graph">
							
							<canvas id="total_deals_cch" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="5">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For HP </h4>
						<div id="total_deals_hp_graph">
							
							<canvas id="total_deals_hp" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
		
				<div class="card card-container-category-column" id="6">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 

							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For PCH </h4>
						<div id="total_deals_pch_graph">
							
							<canvas id="total_deals_pch" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="7">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 

							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Total Deals By Competitor For BCH </h4>
						<div id="total_deals_bch_graph">
							
							<canvas id="total_deals_bch" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="8">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Average Representative APR By Competitor </h4>
						<div id="average_apr_graph">
							
							<canvas id="average_apr" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="9">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Average Term By Competitor </h4>
						<div id="average_term_graph">
							
							<canvas id="average_term" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>
			
				<div class="card card-container-category-column" id="10">
					<div class="card-body">
						<div class="float-end d-none d-md-inline-block">
							<div class="btn-group mb-2">
								 <!-- <input type="month" id="on_the_road_price_month" name="on_the_road_price_month" value="2022-08" onchange="on_the_road_price_setmonth(this);"/> -->
								
								 
							</div>
						</div>
						<h4 class="card-title mb-4" id="total_deals_heading"> Annual Milage By Competitor </h4>
						<div id="average_milage_graph">
							
							<canvas id="average_milage" width="600" height="400" ></canvas>
						</div>
					</div>
					
				</div>

				<!-- <div class="col-md-6 card-container-category-column " id="11">
					<div class="card">
						<div class="card-body">
							<div class="float-end d-none d-md-inline-block">
								<div class="btn-group mb-2">
									
									
								</div>
							</div>
							<h4 class="card-title mb-4 column_chart_heading"></h4>
							<div id="column_graph">
					
								<canvas id="column" width="400" height="200" ></canvas>
							</div>
							<button onclick="download('comparison');">Download</button>
						</div>
						
					</div>
				</div> -->
			{% endif %}
		
		</div>
	</div>
	<div class="col-xl-4">
		<div class="card">
			<div class="card-body">
				<div class="float-end">
					
				</div>
				
				<select name="" id="type_of_finance_select" class="pull-right" onchange="ChangeDonutChartFormat(this)">
					<!-- <option value="">Select Format Type</option> -->
					<option value="value" selected>By Value</option>
					<option value="percentage">By Percentage</option>

				</select>
				
				<h4 id="select_type_of_finance" class="card-title mb-4 select_type_of_finance">Type Of Finance</h4>
				
				<div id="donut-chart2" class="apex-charts"></div>
				

				<div id="data">
				</div>
				
			</div>
		</div>
		
	</div>
</div>
<!-- end row -->

<!-- end row -->
<div class="row">
	
	<div class="col-lg-12">
		<div class="card">
			<div class="card-body">
				<div class="overlay"></div>
				<h4 class="card-title mb-4" id="latest_data"></h4>
				<div class="table-responsive">
					<table  id="datatable2" class="table table-bordered dt-responsive normal datatable2" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
						<thead>
						<tr>
							
							<th>Date Extract Run</th>
							<th>Car Make</th>
							<th>Car Model</th>
							<th>Type of Finance</th>
							<th>Monthly Payment</th>
							<th>Customer Deposit</th>
							<th>Retailer Deposit Contribution</th>
							<th>Representative APR</th>
							<th>Total Amount Payable</th>
							<th>On The Road Price</th>
							<th>Duration of Agreement</th>
							<th>Optional Purchase_Final Payment</th>
							<th>Amount of Credit</th>
							<th>Option To Purchase_Purchase Activation Fee</th>
							<th>Fixed Interest Rate_Rate of interest PA</th>
							<th>Excess Milage Charge</th>
							<th>Average Miles Per Year</th>
							<th>Retail Cash Price</th>
							<th>Offer Expiry Date</th>
							<th>Deposit Percent</th>
							<th>Final Payment Percent</th>
							<th>Webpage URL</th>
							<th>Carimage URL</th>

						</tr>
						</thead>        
						
					</table>
					
				</div>
			</div>
		</div>
	</div>
</div>
<!-- end row -->{% endblock content %}

{% block extra_javascript %}
<script src="https://code.jquery.com/jquery-3.5.1.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
<script src="{% static 'js/pages/datatables.init.js' %}" type="text/javascript"></script>
<!-- <script src="https://www.watchmycompetitor.com/content/lib/jqueryUI/jquery-ui.js"></script> -->
<script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js" type="text/javascript"></script>

<!-- Buttons examples -->



<!-- <script src="https://data.jsdelivr.com/v1/package/npm/busy-load/badge)](https://www.jsdelivr.com/package/npm/busy-load"></script> -->
<script src="{% static 'libs/datatables.net-keytable/js/dataTables.keyTable.min.js' %}" type="text/javascript"></script>
<script src="{% static 'libs/datatables.net-select/js/dataTables.select.min.js' %}" type="text/javascript"></script>
<script src="https://cdn.datatables.net/select/1.4.0/js/dataTables.select.min.js" type="text/javascript"></script>
<script src="{% static 'libs/metismenu/metisMenu.min.js' %}"></script>

<!-- Add HighCharts Libraries -->
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js" type="text/javascript"></script>

<!-- Add DataTable DateTime Library -->
<script src="https://cdn.datatables.net/datetime/1.1.2/js/dataTables.dateTime.min.js"></script>

<!-- Datatable init js -->        
<script src="https://cdn.jsdelivr.net/npm/busy-load/dist/app.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.2.0/js/bootstrap-datepicker.min.js"></script> -->
		
<link href="{% static 'libs/apexcharts/apexcharts.css' %}" id="app-style" rel="stylesheet" type="text/css" />

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.12.1/js/standalone/selectize.js"></script>

<script src="/static/js/draggable.min.js"></script>
<script src="/static/js/dragula.min.js"></script>

<script src="/static/js/chartjs-plugin-datalabels.min.js" type="text/javascript"></script>
<!-- <script src="/static/js/chartjs-plugin-zoom.js" type="text/javascript"></script>
<script src="/static/js/chartjs-plugin-zoom.min.js" type="text/javascript"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/gh/dubrox/Multiple-Dates-Picker-for-jQuery-UI@master/jquery-ui.multidatespicker.js"></script> -->

<script src="/static/js/jquery-ui.multidatespicker.js" type="text/javascript"></script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.0.0-rc.5/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@1.5.3/dist/jspdf.min.js"></script>


<!-- <script src="https://code.jquery.com/jquery-1.12.4.js"></script> -->

<script>
	
</script>

<script>
	$(function(){
		var elem = document.getElementById('month');
        elem.style.display = 'none';
	});
</script>

<script>
	$(function() {

		dates = document.getElementById('dates').value;
		dates = dates.replace('[','');
		dates = dates.replace(']','');
		dates = dates.replace(/"|'/g, '');
		dates = dates.replace(/\s/g, "");

		dates = dates.split(',')
		
		var list = new Array;

		function available(date) {
		dmy = date.getDate() + "-" + (date.getMonth()+1) + "-" + date.getFullYear();
		console.log(dmy)
		//console.log(date)
		
		if ($.inArray(dmy, dates) != -1) {
			
			//console.log('Available');
			return [true, "","Available"];
		} else {
			//console.log('UnAvailable');
			return [false,"","unAvailable"];
		}
		}


		$('#datepicker').multiDatesPicker({ beforeShowDay: available,onSelect: function(dateText){
			//alert(dateText);
			list.push(dateText);
			setmonth();
		} });
		

		
		/*
		$('#datepicker').multiDatesPicker({
			onSelect: myFunction
		});

		function myFunction(dateText, inst){
			console.log("A date has been added: " + dateText);
			list.push(dateText);
		}
		*/
		
		
		/*
		$("#datepicker").datepicker({
			//dateFormat: "mm/dd/yy",
			multidate: true,
			multidateSeparator: ",",
			beforeShowDay: available
		});
		*/
		
		
		var selected_datepicker_values = $('#datepicker').val();

		

	 });
	//var date = $("#datepicker2").datepicker("getDate");
    ////alert($.datepicker.formatDate("dd-mm-yy", date));

	
</script>

<!-- <script>
	$(function(){
		$('#datepicker').multiDatesPicker({
			onSelect: myFunction
		});

		function myFunction(dateText, inst){
			console.log("A date has been added: " + dateText);
			setmonth()
		}
	});
</script> -->


<script>
	function generate_comparison_chart(){
		var month = selectize.getValue();
		selected_column1_value = $('#comparison_column1').val();
		selected_column2_value = $('#comparison_column2').val();
		$.ajax({
			url:"{% url 'generate_comparison_chart'%}?&month="+month+"&selected_column1="+selected_column1_value+"&selected_column2="+selected_column2_value+"",
			method: 'GET',
			success: function(result){

			}

		});


	}
</script>

<script>
	
	
	$(document).ready(function () {
		$(".advance_btn").click(function () {
			//$('advance_btn i').removeClass('ri-add-line');
			$('.advance_btn i').toggleClass('ri-subtract-line');
			$(".apply_filter_card").slideToggle();
		});
	});
	
	
</script>

<script>
	

	var select1 = $('#carmake_filter').selectize({
		plugins: ['remove_button'],
		onItemRemove: function() {
			
			this.open();
		},
		maxItems: 12
	  });
	  
	var selectize1 = select1[0].selectize;

	var select2 = $('#finance_offers_filter').selectize({
		plugins: ['remove_button'],
		onItemRemove: function() {
			
			this.open();
		},
		maxItems: 12
	  });
	  
	var selectize2 = select2[0].selectize;


	/*
	var select3 = $('#selected_column').selectize({
		plugins: ['remove_button'],
		onItemRemove: function() {
			
			this.open();
		},
		maxItems: 1
	  });
	  
	var selectize3 = select3[0].selectize;
	*/	

</script>

<script>
	$(document).ready( function () {
		//alert(location.href)
		$('.spinner').removeClass('d-none');
			axios({
				method:'GET',
				url: "{% url 'latest_records' %}",
			}).then(function(response){
				//////alert(response.data.records);
				////console.log(response.data.records);
				$('.spinner').addClass('d-none');
				$('#latest_records').html(response.data.records);
				var latest_date = response.data.latest_date;
				$( "#datepicker" ).datepicker( "setDate",latest_date);
				setmonth();
				/*
				$('#retailer_contribution_heading').append(response.data.month)
				$('#customer_deposit_heading').append(response.data.month)
				$('#monthly_payment_heading').append(response.data.month)
				$('#representative_apr_heading').append(response.data.month)
				$('#on_the_road_price_heading').append(response.data.month)
				*/

				var div = document.getElementById('latest_number_of_records')
				temp = response.data.month;
				
				$('#month option:contains('+response.data.month+')').prop('selected',true);
				$('#month1 option:contains('+response.data.month+')').prop('selected',true);
				$('#month2 option:contains('+response.data.month+')').prop('selected',true);
				$('#month3 option:contains('+response.data.month+')').prop('selected',true);
				$('#month4 option:contains('+response.data.month+')').prop('selected',true);


				div.innerHTML += ' in ' +  response.data.month;
				
				//selectize.setValue(response.data.month_value);

				//console.log('Console: ', response.data.month);
				


		})
	});
</script>

<script>
	$(document).ready( function () {
		
		$('.spinner').removeClass('d-none');
			axios({
				method:'GET',
				url: "{% url 'second_latest_records' %}",
			}).then(function(response){

				$('.spinner').addClass('d-none');
				$('#second_latest_records').html(response.data.records);
				var div = document.getElementById('second_latest_number_of_records')
				div.innerHTML += ' in ' +  response.data.month;
				//console.log('Console: ', response.data.month);
				
		})
	});
</script>

<script>
	$(document).ready( function () {
		
		$('.spinner').removeClass('d-none');
			axios({
				method:'GET',
				url: "{% url 'third_latest_records' %}",
			}).then(function(response){

				$('.spinner').addClass('d-none');
				$('#third_latest_records').html(response.data.records);
				var div = document.getElementById('third_latest_number_of_records')
				div.innerHTML += ' in ' +  response.data.month;
				//console.log('Console: ', response.data.month);
				
		})
	});
</script>

<!-- <script>
	$(document).ready( function () {
		
		$(document).ajaxStart(function () {
			//////alert('Start');
			
		});

		var table = $('#datatable2').DataTable({
			"initComplete": function(settings, json) {
				
			},
			"ajax": "{% url 'santandar-car-latest-data' %}",
			"drawCallback": function (settings) { 
				

				
			},
			processing:true,
			"language": {
				processing: '<i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>'},
			searchPanes: {
				cascadePanes: true,
				viewTotal: true,
				layout: 'columns-4',
				"columns": [0,1,2,3]
			},
			dom: 'Plfrtip',
			
			"pagingType": "numbers",
			
			sort:true,
			columns: [
			{"data": "users.DateExtractRun","name":"DateExtractRun"},
			{"data": "users.CarMake","name":"CarMake"},
			{"data": "users.CarModel","name":"Car Model"},
			{"data": "users.TypeofFinance","name":"TypeofFinance"},
			{"data": "users.MonthlyPayment","name":"MonthlyPayment"},
			{"data": "users.CustomerDeposit","name":"CustomerDeposit"},
			{"data": "users.RetailerDepositContribution","name":"RetailerDepositContribution"},
			{"data": "users.RepresentativeAPR","name":"RepresentativeAPR"},
			{"data": "users.TotalAmountPayable","name":"TotalAmountPayable"},
			{"data": "users.OnTheRoadPrice","name":"OnTheRoadPrice"},
			{"data": "users.DurationofAgreement","name":"DurationofAgreement"},
			{"data": "users.OptionalPurchase_FinalPayment","name":"OptionalPurchase_FinalPayment"},
			{"data": "users.AmountofCredit","name":"AmountofCredit"},
			{"data": "users.OptionToPurchase_PurchaseActivationFee","name":"OptionToPurchase_PurchaseActivationFee"},
			{"data": "users.FixedInterestRate_RateofinterestPA","name":"FixedInterestRate_RateofinterestPA"},
			{"data": "users.ExcessMilageCharge","name":"ExcessMilageCharge"},
			{"data": "users.AverageMilesPerYear","name":"AverageMilesPerYear"},
			{"data": "users.RetailCashPrice","name":"RetailCashPrice"},
			{"data": "users.OfferExpiryDate","name":"OfferExpiryDate"},
			{"data": "users.DepositPercent","name":"DepositPercent"},
			{"data": "users.FinalPaymentPercent","name":"FinalPaymentPercent"},
			{"data": "users.WebpageURL","name":"WebpageURL"},
			{"data": "users.CarimageURL","name":"CarimageURL"},
				],
			
			
		serverSide: true,
		select: true,
		});

		$(document).ajaxStop(function () {
			//////alert('End');
			////console.log('End');
			//$.busyLoadFull("hide");
			//$(".overlay").removeClass("loading"); 
		});

		

	});

	function chartData(table) {
			var counts = {};
		
			table
				.column(2, { search: 'applied' })
				.data()
				.each(function (val) {

					////console.log(table.column(2).data());
					if (counts[val]) {
						counts[val] += 1;
					} else {
						counts[val] = 1;
					}
				});
		
			// And map it to the format highcharts uses
			return $.map(counts, function (val, key) {
				return {
					name: key,
					y: val,
				};
			});
	}
</script> -->





<script>
	/*	
	$(document).ready(function(){

	//Default Customer Deposit
	axios({
		method:'GET',
		url: "{% url 'default_customer_deposit' %} ",
	}).then(function(response){
		const ctx = document.getElementById('customer_deposit').getContext('2d');
		const myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Customer Deposit',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Price'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					}
				}
			}
		});
	})

	// Default Monthly Payment
	
	axios({
		method:'GET',
		url: "{% url 'default_monthly_payment' %} ",
	}).then(function(response){
		const ctx = document.getElementById('monthly_payment').getContext('2d');
		const myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Monthly Payment',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Price'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					}
				}
			}
		});
	})

	// Default representative APR
	
	axios({
		method:'GET',
		url: "{% url 'default_representative_apr' %} ",
	}).then(function(response){
		const ctx = document.getElementById('representative_apr').getContext('2d');
		const myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'Representative APR',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Price'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					}
				}
			}
		});
	})


	// Default On the Road Price
	
	axios({
		method:'GET',
		url: "{% url 'default_on_the_road_price' %} ",
	}).then(function(response){
		const ctx = document.getElementById('on_the_road_price').getContext('2d');
		const myChart = new Chart(ctx, {
			type: 'bar',
			data: {
				labels: response.data.labels,
				datasets: [{
					label: 'On The Road Price',
					data: response.data.data,
					backgroundColor: '#848fdf'
				}]
			},
			options: {
				scales: {
					y: {
						//beginAtZero: true
						title:{
							display:true,
							text:'Price'
						},
						grid: {
							display: false
						}
					},
					x:{
						ticks:{
							maxRotation: 90,
							minRotation: 60
						},
						grid: {
							display: false
						}
					}
				},
				plugins: {
					legend: {
						display: true,
						
					}
				}
			}
		});
	})


});
*/
</script>
<script src="/static/js/draggable.min.js"></script>
<script src="/static/js/dragula.min.js"></script>
<script>

	function GridBasketSortIndex(csvAlertSortOrder) {
		try {
			//////alert()
			var arrayBasketAlerts = [];
			arrayBasketAlerts = csvAlertSortOrder.split(",");
	
			$.each(arrayBasketAlerts, function (index, value) {
				$("#" + value).attr("data-sort", index);
			});
		} catch (exception) {
			// //console.log(exception);
		}
	}


	/*
	$("#divBattleCardContent").sortable({
            placeholder: "ui-state-highlight",
            items: ".card-container-category-column",
            update: function (event, ui) {
                var csvAlertSortOrder = $(this).sortable('toArray').toString();
                GridBasketSortIndex(csvAlertSortOrder);
                UpdateBattlecardBasketSortIndex(csvAlertSortOrder);
            }
        });
	*/

	$("#card-analytics-drag-area").sortable({
		placeholder: "ui-state-highlight",
		items: ".card-container-category-column",
		update: function (event, ui) {

			//console.log('Ui: '+ ui)

			var basketSortOrder = $(this).sortable('toArray').toString();
			//////alert(basketSortOrder);
			////console.log('Sortable: '+ basketSortOrder);
			GridBasketSortIndex(basketSortOrder);
			UpdateGridBasketSortIndex(basketSortOrder);
		}
	});

	
	function UpdateGridBasketSortIndex(basketSortOrder) {
		//var basketId = $("#baskets").val();
		//var basketId  = document.getElementById("baskets");
		//value = basketId.options[basketId.selectedIndex].value;
		//////alert(value)
		
		var basket_sort_order = basketSortOrder;
		var e = document.getElementById("project_id");
		var project_id = e.value;
		
		
		axios({
			method:'GET',
			url: "{% url 'dashboard_sorted_order' %}?basketsortorder="+basket_sort_order+"&project_id="+project_id+"",
		}).then(function(response){
			//////alert('SUCCESS')
		})
		
	}
	
</script>
<script>
	$('.date_form-check-input').click(function(e){
		////alert($(this).val())
	});
	$('.carmake_form-check-input').click(function(e){
		////alert($(this).val())
	});
	$('.carmodel_form-check-input').click(function(e){
		////alert($(this).val())
	});
	$('.tof_form-check-input').click(function(e){
		////alert($(this).val())
	});
	$('.monthly_form-check-input').click(function(e){
		////alert($(this).val())
	});
</script>
{% endblock extra_javascript %}